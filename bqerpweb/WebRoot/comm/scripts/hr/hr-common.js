// code定义
var codeDefine = {
    "奖惩类别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "奖励"
        }, {
            value : "2",
            text : "处罚"
        }],
    "工作类别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "常白班"
        }, {
            value : "2",
            text : "运行班"
        }],
    "附件来源" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "新签合同"
        }, {
            value : "1",
            text : "变更合同"
        }, {
            value : "2",
            text : "续签合同"
        }, {
            value : "3",
            text : "终止合同"
        }, {
            value : "4",
            text : "劳务派遣"
        }],
    "是否常设岗" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "是否注销" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "机构变更类别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "增加"
        }, {
            value : "2",
            text : "增加(合并)"
        }, {
            value : "3",
            text : "撤销(拆分)"
        }, {
            value : "4",
            text : "撤销"
        }, {
            value : "5",
            text : "名称变更"
        }, {
            value : "6",
            text : "级别变更"
        }],
    "是否领导岗位" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "是否退转军人" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "部门性质" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "主业"
        }, {
            value : "2",
            text : "多经"
        }, {
            value : "3",
            text : "全民支援集体"
        }, {
            value : "4",
            text : "代管单位"
        }],
    "劳动合同形式" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "新签合同"
        }, {
            value : "1",
            text : "续签合同"
        }],
    "变动类别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "调动"
        }, {
            value : "2",
            text : "绩效变动"
        }, {
            value : "3",
            text : "奖惩违纪"
        }, {
            value : "4",
            text : "其它"
        }],
    "员工状态" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "新进"
        }, {
            value : "2",
            text : "存档"
        }, {
            value : "3",
            text : "离职"
        }],
    "劳动合同终止类别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "终止"
        }, {
            value : "2",
            text : "解除"
        }],
    "工种类别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "特殊工种"
        }, {
            value : "2",
            text : "行业工种"
        }, {
            value : "3",
            text : "社会工种"
        }],
    "是否班组" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "性别" : [
    //update by sychen 20100702
//    	{
//            value : "",
//            text : ""
//        }, 
        	{
        	// modified by liuyi 091124 与数据库中已有数据一致
//            value : "m",
        	value : "M",
            text : "男"
        }, {
        	// modified by liuyi 091124 与数据库中已有数据一致
//            value : "f",
        	value : "W",
            text : "女"
        }],
    "婚否" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "婚否状况" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "已婚"
        }, {
            value : "1",
            text : "未婚"
        }, {
            value : "2",
            text : "离异"
        }, {
            value : "3",
            text : "丧偶"
        }],
    "是否毕业" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "是否原始学历" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "是否最高学历" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "教育结果" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "毕业"
        }, {
            value : "2",
            text : "结业"
        }, {
            value : "3",
            text : "肆业"
        }, {
            value : "4",
            text : "其他"
        }],
    "是否最新标志" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "是否直系" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "是否供养" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "岗位调动类别" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "班组间"
        }, {
            value : "1",
            text : "部门间"
        }, {
            value : "2",
            text : "公司间"
        }],
    "部门级别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "一级部门"
        }, {
            value : "2",
            text : "二级部门"
        }, {
            value : "3",
            text : "三级部门"
        }, {
            value : "4",
            text : "四级部门"
        }, {
            value : "5",
            text : "五级部门"
        }],
    "岗薪变化类别" : [{
            value : "",
            text : ""
        }, {
            value : "1",
            text : "低岗至高岗"
        }, {
            value : "2",
            text : "高岗至低岗"
        }, {
            value : "3",
            text : "平级调动"
        }],
    "单据状态" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "未上报"
        }, {
            value : "1",
            text : "已上报"
        }, {
            value : "2",
            text : "已终结"
        }, {
            value : "3",
            text : "已退回"
        }],
    "是否已回" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }],
    "存档" : [{
            value : "",
            text : ""
        }, {
            value : "0",
            text : "否"
        }, {
            value : "1",
            text : "是"
        }]
};

/**
 * 根据项目名和code值找到对应code说明
 * 
 * @param {}
 *            type code类别，比如：“部门级别”
 * @param {}
 *            value code值，比如：“0”
 */
function getCodeName(type, value) {
    var array = codeDefine[type];
    if (array instanceof Array) {
        for (var i = 0; i < array.length; i++) {
            if (array[i].value == value)
                return array[i].text;
        }
    }
    return "";
}
// 业务共通drp类别
var drpTypes = ["籍贯", "民族", "政治面貌", "员工身份", "员工类别", "技术职称", "技术等级", "工种", "劳保工种", "学校", "学历", "学位", "学习专业", "学习类别",
    "语种", "称谓", "调动部门", "岗位级别", "岗位类别", "进厂类别", "协作单位", "离职类别"
    ];

/**
 * 静态DRP,参照code定义书
 * 
 * @class Ext.form.CmbHRCode
 * @extends Ext.form.ComboBox
 */
Ext.form.CmbHRCode = Ext.extend(Ext.form.ComboBox, {
    width : 180,
    /**
     * 类型（比如：部门级别）
     * 
     * @type String
     */
    type : "",
    allowBlank : true,
    forceSelection : true,
    triggerAction : 'all',
    mode : 'local',
    readOnly : true,
    displayField : 'text',
    valueField : 'value',
    // private
    initComponent : function() {
        if (codeDefine[this.type]) {
            this.store = new Ext.data.JsonStore({
                fields : ['value', 'text'],
                data : codeDefine[this.type]
            })
        } else {
            this.store = new Ext.data.JsonStore({
                fields : ['value', 'text'],
                data : []
            });
        }
        Ext.form.CmbHRCode.superclass.initComponent.call(this);
    }
});
Ext.reg('CmbHRCode', Ext.form.CmbHRCode);

/**
 * 业务共通动态DRP，参照业务共通设计书
 * 
 * @class Ext.form.CmbHRBussiness
 * @extends Ext.form.ComboBox
 */
Ext.form.CmbHRBussiness = Ext.extend(Ext.form.ComboBox, {
    width : 180,
    /**
     * 类型-》设置drp的类别
     * 
     * @type String
     */
    type : "",
    allowBlank : true,
    forceSelection : true,
    triggerAction : 'all',
    mode : 'local',
    readOnly : true,
    displayField : 'text',
    valueField : 'id',
    // private
    initComponent : function() {
        if (drpTypes.indexOf(this.type) != -1) {
            // store
            this.store = new Ext.data.JsonStore({
                url : "hr/getCommDrpStoreDatas.action",
                root : 'list',
                fields : ['id', 'text']
            });
            var drptype = this.type;
            // 参数
            this.store.on('beforeload', function(store) {
                Ext.apply(store.baseParams, {
                    strDrpType : drptype
                })
            });
            // 取数据
            this.store.load();
        } else {
            this.store = new Ext.data.JsonStore({
                fields : ['id', 'text'],
                data : []
            });
        }
        Ext.form.CmbHRBussiness.superclass.initComponent.call(this);
    }
})

Ext.reg('CmbHRBussiness', Ext.form.CmbHRBussiness);

/**
 * 自然数输入控件
 * 
 * @class Ext.form.naturalNumberField
 * @extends Ext.form.NumberField
 */
Ext.form.NaturalNumberField = Ext.extend(Ext.form.NumberField, {
    /**
     * 是否允许输入0
     * 
     * @type Boolean
     */
    allowZero : false,
    // private
    initEvents : function() {
        Ext.form.NaturalNumberField.superclass.initEvents.call(this);
        var allowed = this.baseChars + '';
        this.stripCharsRe = new RegExp('[^' + allowed + ']', 'gi');
        var keyPress = function(e) {
            var k = e.getKey();
            if (!Ext.isIE && (e.isSpecialKey() || k == e.BACKSPACE || k == e.DELETE)) {
                return;
            }
            var c = e.getCharCode();
            if (allowed.indexOf(String.fromCharCode(c)) === -1) {
                e.stopEvent();
            } else {
                var testValue = this.getTestValue(String.fromCharCode(c));
                var value = this.parseValue(testValue)
                if ((this.allowZero && value < 0) || (!this.allowZero && value <= 0)) {
                    e.stopEvent();
                }
            }
        };
        this.el.on("keypress", keyPress, this);
    },
    // private
    onRender : function(ct, position) {
        Ext.form.NaturalNumberField.superclass.onRender.call(this, ct, position);
        this.el.dom.maxLength = 15;
    },
    processValue : function(value) {
        var value = Ext.form.NaturalNumberField.superclass.processValue.call(this, value);
        if (!this.allowZero) {
            if (parseInt(value) === 0) {
                this.setRawValue("");
                return "";
            }
        }
        return value;
    },
    // private
    getTestValue : function(input) {

        var dom = this.el.dom;
        // 选中的文本
        var select = "";
        dom.focus();
        var currentRange = document.selection.createRange();

        if (currentRange && currentRange.parentElement() == dom) {
            select = currentRange.text;
        }
        var workRange = currentRange.duplicate();

        dom.select();
        var allRange = document.selection.createRange();
        // 光标位置
        var len = 0;
        while (workRange.compareEndPoints("StartToStart", allRange) > 0) {
            workRange.moveStart("character", -1);
            len++;
        }
        currentRange.select();
        var array = this.el.getValue().split("");
        array.splice(len, select.length, input);
        return array.join("");
    }
});
Ext.reg('NaturalNumberField', Ext.form.NaturalNumberField);

/**
 * 编码和检索码输入域（只允许输入半角英数字）
 * 
 * @class Ext.form.CodeField
 * @extends Ext.form.TextField
 */
Ext.form.CodeField = Ext.extend(Ext.form.TextField, {
    style : {
        'ime-mode' : 'disabled'
    },
    // private
    initEvents : function() {
        Ext.form.CodeField.superclass.initEvents.call(this);
        var allowed = /[a-zA-Z0-9]/;
        this.stripCharsRe = new RegExp('[^a-zA-Z0-9]', 'gi');
        var keyPress = function(e) {
            var k = e.getKey();
            if (!Ext.isIE && (e.isSpecialKey() || k == e.BACKSPACE || k == e.DELETE)) {
                return;
            }
            var c = e.getCharCode();
            if (!allowed.test(String.fromCharCode(c))) {
                e.stopEvent();
            }
        };
        this.el.on("keypress", keyPress, this);
    }
});
Ext.reg('CodeField', Ext.form.CodeField);

/** 添加人: 胡由 添加日期: 2009/02/12 添加开始 */
Ext.apply(Ext.form.TextField.prototype, {
    // 显示控件(包括控件的Label)
    showField : function() {
        if (this.rendered) {
            this.el.up('.x-form-item').removeClass('x-hide-label');
            this.show();
            this.un('render', this.showField);

            return;
        }
        this.on('render', this.showField);
    },
    // 隐藏控件(包括控件的Label)
    hideField : function() {
        if (this.rendered) {
            this.el.up('.x-form-item').addClass('x-hide-label');
            this.hide();
            this.un('render', this.hideField);

            return;
        }
        this.on('render', this.hideField);
    }
});
/** 添加人: 胡由 添加日期: 2009/02/12 添加结束 */

/** 添加人: 胡由 添加日期: 2009/02/17 添加开始 */
// 当给ComboBox设置的值在对应的Store中不存在时, 设置为空字串
var tempSetValue = Ext.form.ComboBox.prototype.setValue;
Ext.form.ComboBox.prototype.setValue = function(v, allowBlank) {
    var value = v;
    if (allowBlank === true) {
        // 如果找不到的话,就设置为空字符串
        value = '';
        if (this.valueField) {
            var r = this.findRecord(this.valueField, v);
            if (r) {
                value = v;
            }
        }
    }

    tempSetValue.apply(this, [value]);
    delete tempSetValue;
};

// 判断是否是正确的文件路径
function checkFilePath(filePath) {
    if (!filePath)
        return false;
    return /^(\w:|\\\\)/.test(String.escape(filePath));
}
/** 添加人: 胡由 添加日期: 2009/02/17 添加结束 */
/** 添加人: 黄维杰 添加日期: 2009/02/24 添加开始 */
// 当名称中存在如<br>等html语言时，会产生换行等效果，此函数用于去掉该效果。
// 转义HTML元素, 参数onlySpaceAndBr不用传，或者设置为false
function escapeHTML(s, onlySpaceAndBr){
   var sb;
   sb = s + "";
   if (typeof onlySpaceAndBr != 'undefined'
   		&& onlySpaceAndBr === true) {
   		/** 2009/02/26 huyou deleted
   		 * 如果自己写了列的renderer方法，则需要自己调用这个方法。这时第二个参数不用传，
   		 * 例如： renderer : function(value) {
   		 *           return "<font color='red'>" + escapeHTML(value) + "</font>";
   		 *       }
   		 */
//		var escapeamp = /<(br\/?)>/gi;
//		var escapenbsp = / (?= )/g;
//		var unescapern = /\r?\n/g;
//		
//		sb = sb.replace(escapeamp, "&lt;$1&gt;");
//		sb = sb.replace(escapenbsp, "&nbsp;");
//		sb = sb.replace(unescapern, "<br/>");
   	} else {
   		var escapelt = /</g;
	    var escapegt = />/g;
	    var escapeamp = /&/g;
	    var escapequot = /"/g;
	    var escapenbsp = / /g;
	    var unescapern = /\r?\n/g;
	    
	    sb = sb.replace(escapeamp, "&amp;");
	    sb = sb.replace(escapelt, "&lt;");
	    sb = sb.replace(escapegt, "&gt;");
	    sb = sb.replace(escapequot, "&quot;");
	    sb = sb.replace(escapenbsp, "&nbsp;");
	    sb = sb.replace(unescapern, "<br/>");
   	}
   
    return sb;
}

var tempRender = Ext.grid.ColumnModel.prototype.getRenderer;
Ext.grid.ColumnModel.prototype.getRenderer = function() {
	var scope = this;
	var args = arguments;
	return function() {
		var value = arguments[0];
		var onlyBr = false;
		if (scope.config && scope.config[args[0]]) {
			onlyBr = !!scope.config[args[0]].renderer;
		}
		// 删除默认的defaultRenderer应用
		if (onlyBr) {
    		var rendFun = tempRender.apply(scope, args);
    		value = rendFun.apply(this, arguments);
		}
		
		if (typeof value == 'string' && value.length > 0) {
			return escapeHTML(value, onlyBr);
		}
		return value;
	}
}
/** 添加人: 黄维杰 添加日期: 2009/02/24 添加结束 */


/** 给Form添加Trim方法 添加人：胡由 添加日期: 2009/02/24 添加开始 */
Ext.form.BasicForm.prototype.trim = function() {
	var form = this.el.dom;

    var el, name, val, disabled, data = '', hasSubmit = false;
    for (var i = 0; i < form.elements.length; i++) {
        el = form.elements[i];
        disabled = el.disabled;
        name = el.name;
        val = el.value;

        if (!disabled && name){
            switch (el.type)
            {
                case 'textarea':
                case 'file':
                case 'text':
                   if(typeof val === 'string' && val.length > 0) {
			           // 删除空格
			           el.value = String(val).replace(/^[\s\u3000]+|[\s\u3000]+$/g, '');
			       }
                   break;
            }
        }
    }
}
/* 添加Trim方法 添加人：胡由 添加日期: 2009/02/24 添加结束 */